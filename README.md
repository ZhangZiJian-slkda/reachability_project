<!--
 * @Author: Zhang-sklda 845603757@qq.com
 * @Date: 2025-11-23 21:59:57
 * @LastEditors: Zhang-sklda 845603757@qq.com
 * @LastEditTime: 2025-11-25 23:52:16
 * @FilePath: /reachability_project/README.md
 * @Description: è¿™æ˜¯é»˜è®¤è®¾ç½®,è¯·è®¾ç½®`customMade`, æ‰“å¼€koroFileHeaderæŸ¥çœ‹é…ç½® è¿›è¡Œè®¾ç½®: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE
-->
# reachability_project
åŸºäºkuka-iiwa-LBRMedç³»åˆ—æœºæ¢°è‡‚çš„å¯è¾¾æ€§å’Œçµæ´»æ€§ä»¿çœŸç ”ç©¶

## é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ªåŸºäº MuJoCo çš„æœºæ¢°è‡‚è¿åŠ¨æ§åˆ¶ç®—æ³•æ¡†æ¶ï¼Œä¸“æ³¨äºæœºæ¢°è‡‚å·¥ä½œç©ºé—´çš„å¯è¾¾æ€§åˆ†æã€‚é€šè¿‡ç¦»æ•£åŒ–å·¥ä½œç©ºé—´å’Œæœ«ç«¯æ‰§è¡Œå™¨æ–¹å‘ï¼Œæ„å»ºé«˜æ•ˆçš„å¯è¾¾æ€§åœ°å›¾ï¼Œç”¨äºè¿åŠ¨è§„åˆ’å’Œä»»åŠ¡å¯è¡Œæ€§åˆ†æã€‚

## æ ¸å¿ƒç‰¹æ€§

### ğŸ¤– æœºå™¨äººæ¨¡å‹
- **å¤šå…³èŠ‚æœºæ¢°è‡‚æ”¯æŒ**ï¼šæ”¯æŒ KUKA iiwa ç­‰ 7 è‡ªç”±åº¦æœºæ¢°è‡‚
- **æ­£å‘è¿åŠ¨å­¦è®¡ç®—**ï¼šå‡†ç¡®çš„æœ«ç«¯æ‰§è¡Œå™¨ä½ç½®å’Œæ–¹å‘è®¡ç®—
- **éšæœºé‡‡æ ·**ï¼šåœ¨å…³èŠ‚é™åˆ¶èŒƒå›´å†…ç”Ÿæˆéšæœºé…ç½®

### ğŸ—ºï¸ å¯è¾¾æ€§åœ°å›¾
- **é«˜æ•ˆå­˜å‚¨**ï¼šä½¿ç”¨ä½æ•°ç»„æŠ€æœ¯ï¼Œæå¤§èŠ‚çœå†…å­˜
- **å¤šç»´åº¦ç¦»æ•£åŒ–**ï¼šä½ç½®ã€æ–¹å‘ã€æ»šè½¬ä¸‰è‡ªç”±åº¦ç¦»æ•£åŒ–
- **å¿«é€ŸæŸ¥è¯¢**ï¼šæ”¯æŒä½å§¿çº§åˆ«çš„å¯è¾¾æ€§æŸ¥è¯¢
- **è¦†ç›–ç‡ç»Ÿè®¡**ï¼šå®æ—¶è®¡ç®—å·¥ä½œç©ºé—´è¦†ç›–ç‡

### ğŸ§ª æµ‹è¯•æ¡†æ¶
- **å•å…ƒæµ‹è¯•**ï¼šå®Œæ•´çš„æ¨¡å—æµ‹è¯•è¦†ç›–
- **çœŸå®æ¨¡å‹æµ‹è¯•**ï¼šåŸºäºå®é™…æœºå™¨äººæ¨¡å‹çš„éªŒè¯
- **æ€§èƒ½æµ‹è¯•**ï¼šå†…å­˜ä½¿ç”¨å’Œè®¡ç®—æ•ˆç‡ç›‘æ§

## é¡¹ç›®ç»“æ„
reachability_project/
â”œâ”€â”€ models/                      # æ”¾ MJCF / URDF ç­‰æœºå™¨äººæ¨¡å‹
â”‚   â””â”€â”€ kuka_iiwa.xml
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ robot_model.py           # RobotModel å°è£… MuJoCo
â”‚   â”œâ”€â”€ reachability_map.py      # ReachabilityMap æ•°æ®ç»“æ„ä¸ IO
â”‚   â”œâ”€â”€ sampler.py               # FK sampler / HYB æ§åˆ¶æµç¨‹
â”‚   â”œâ”€â”€ collision.py             # ç‚¹äº‘ KD-tree + primitive collision checker
â”‚   â”œâ”€â”€ analyze.py               # Capability è®¡ç®—ã€ä½“ç§¯ç»Ÿè®¡ã€å¯è§†åŒ–
â”‚   â””â”€â”€ run_generation.py        # è„šæœ¬ï¼šé…ç½® + è¿è¡Œ map ç”Ÿæˆ
â”œâ”€â”€ notebooks/                   # jupyter åˆ†æå¯è§†åŒ–
â””â”€â”€ README.md


robot_model.py
1.åˆå§‹åŒ–æµ‹è¯• - æˆåŠŸåŠ è½½ KUKA iiwa æ¨¡å‹ï¼Œæ­£ç¡®è¯†åˆ«7ä¸ªå…³èŠ‚
2.é›¶ä½å§¿æ­£å‘è¿åŠ¨å­¦ - è¿”å›æ­£ç¡®çš„ä½ç½® [0, 0, 1.306] å’Œå•ä½æ—‹è½¬çŸ©é˜µ
3.ä¸åŒä½å§¿æ­£å‘è¿åŠ¨å­¦ - å„ç§å…³èŠ‚é…ç½®ä¸‹FKè®¡ç®—æ­£ç¡®
4.éšæœºå…³èŠ‚é‡‡æ · - æˆåŠŸç”Ÿæˆéšæœºå…³èŠ‚è§’åº¦
5.æ­£å‘è¿åŠ¨å­¦ä¸€è‡´æ€§ - å¤šæ¬¡è®¡ç®—ç›¸åŒé…ç½®ç»“æœä¸€è‡´
6.è‡ªå®šä¹‰TCPç«™ç‚¹ - æ­£ç¡®ä½¿ç”¨ attachment_site
7.é”™è¯¯è¾“å…¥å¤„ç†æµ‹è¯•


reachability_map.py
1.åˆå§‹åŒ–æµ‹è¯• - éªŒè¯å¯è¾¾æ€§åœ°å›¾å‚æ•°æ­£ç¡®è®¾ç½®
2.ä½ç½®æ˜ å°„æµ‹è¯• - æµ‹è¯•ä¸‰ç»´åæ ‡åˆ°ä½“ç´ ç´¢å¼•çš„è½¬æ¢
3.æ–¹å‘æ˜ å°„æµ‹è¯• - éªŒè¯å•ä½å‘é‡åˆ°æ–¹å‘ç´¢å¼•çš„æ˜ å°„
4.æ»šè½¬æ˜ å°„æµ‹è¯• - æµ‹è¯•æ»šè½¬è§’åº¦åˆ°ç´¢å¼•çš„è½¬æ¢
5.ä½“ç´ æ“ä½œæµ‹è¯• - éªŒè¯å•ä¸ªä½“ç´ çš„è®¾ç½®å’ŒæŸ¥è¯¢
6.ä½å§¿æ“ä½œæµ‹è¯• - æµ‹è¯•å®Œæ•´çš„æœºå™¨äººä½å§¿ï¼ˆä½ç½®+æ–¹å‘+æ»šè½¬ï¼‰è®¾ç½®å’ŒæŸ¥è¯¢
7.è¦†ç›–ç‡è®¡ç®—æµ‹è¯• - éªŒè¯å¯è¾¾æ€§åœ°å›¾çš„è¦†ç›–ç‡ç»Ÿè®¡åŠŸèƒ½
8.è¾¹ç•Œæƒ…å†µæµ‹è¯• - æµ‹è¯•è¶…å‡ºå·¥ä½œç©ºé—´èŒƒå›´çš„ä½ç½®å¤„ç†
9.å†…å­˜æ•ˆç‡æµ‹è¯• - éªŒè¯ä½æ•°ç»„å­˜å‚¨çš„å†…å­˜æ•ˆç‡



æœºå™¨äººæ¨¡å‹å‡†å¤‡ï¼šè·å–/ç”Ÿæˆ KUKA iiwa LBR MED çš„ URDF æˆ– MJCFï¼ˆåŒ…å«è¿æ†ã€å…³èŠ‚ã€æœ«ç«¯å·¥å…·ï¼‰ï¼Œå¹¶åœ¨ MuJoCo ä¸­èƒ½è®¡ç®— FKï¼ˆä½ç½®/å§¿æ€ï¼‰ä¸åšç¢°æ’æ£€æµ‹ï¼ˆMuJoCo è‡ªå¸¦ç¢°æ’/contacts å¯ç”¨ï¼‰ã€‚
åŸºç¡€æ¨¡å—å®ç°ï¼š
RobotModelï¼šå°è£… MuJoCo æ¨¡å‹è½½å…¥ï¼ŒFKï¼ˆç»™å®šå…³èŠ‚è§’è¿”å› TCP poseï¼‰ã€è®¾ç½®å…³èŠ‚ã€ä»æ¨¡å‹è¯»å–å…³èŠ‚ä¸Šä¸‹é™ã€å…³èŠ‚è‡ªç”±åº¦ç­‰ã€‚
ReachabilityMapï¼šåŸºäºè®ºæ–‡ III èŠ‚å®ç°â€œåˆ†è§£ç´¢å¼•â€ï¼ˆic, ia, irï¼‰ã€å†…å­˜å¸ƒå±€ï¼ˆæŒ‰ä½å­˜å‚¨ï¼‰ä¸æŸ¥è¯¢/å†™æ“ä½œæ¥å£ã€‚
Samplerï¼šå®ç° FK éšæœºé‡‡æ ·æ¨¡å—ï¼ˆç”Ÿæˆéšæœº joint vector â†’ FK â†’ map å†™å…¥ï¼‰ï¼Œå®ç° IK éªŒè¯æ¥å£ï¼ˆå¯æ¥ ikpy æˆ–åŸºäº Jacobian çš„æ•°å€¼æ±‚è§£ï¼‰ç”¨äº HYB è¡¥å…¨ã€‚
æ··åˆç”Ÿæˆ HYB æµç¨‹ï¼ˆå®ç°è®ºæ–‡æè¿°çš„åˆ‡æ¢é˜ˆå€¼ç­–ç•¥ï¼‰å¹¶æµ‹é‡é¢„æµ‹ç²¾åº¦ï¼ˆéšæœºæŠ½æ · vs map æŸ¥è¯¢ vs IK æ±‚è§£ï¼‰ã€‚
ç¯å¢ƒä¸ç¢°æ’ï¼šå®ç°ç¯å¢ƒç‚¹äº‘ï¼ˆæˆ– CAD ç½‘æ ¼ç¦»æ•£ä¸ºç‚¹é›†ï¼‰å¯¼å…¥ + KD-tree åŠ é€Ÿ radius queries + primitive è¿‘ä¼¼ç¢°æ’ï¼ˆçƒ/åœ†æŸ±ï¼‰æˆ–ç›´æ¥ä½¿ç”¨ MuJoCo ç¢°æ’æ£€æµ‹ï¼ˆé€Ÿåº¦å¯èƒ½ç•¥æ…¢ï¼Œä½†æ›´ç²¾ç¡®ï¼‰ã€‚
åˆ†æ/å¯è§†åŒ–ä¸ä¼˜åŒ–ï¼šè®¡ç®— Capabilityï¼ˆreachability indexï¼‰ã€å¯è§†åŒ–æ¨ªæˆªé¢çƒ­å›¾ã€ç»Ÿè®¡ä½“ç§¯/é«˜ dexterity åŒºåŸŸï¼ˆè®ºæ–‡ Table III/IV é£æ ¼ï¼‰ï¼Œå¹¶è¿›è¡Œå‚æ•° sweepï¼ˆr, da, drï¼‰ä¸å†…å­˜/ç²¾åº¦æŠ˜ä¸­ï¼ˆå‚è€ƒè®ºæ–‡ Table IIï¼‰ã€‚


HYB = Hybrid FK + IK
è®ºæ–‡å»ºè®®ï¼š
1. FK é˜¶æ®µå¡«æ»¡å¤§éƒ¨åˆ† mapï¼ˆä½ å·²ç»å¼€å§‹åšäº†ï¼‰
2. å¯¹å‰©ä½™ç©º bin ç”¨ IK éªŒè¯
æ ¹æ®ä½“ç´ ä¸­å¿ƒ + approach æ–¹å‘ + roll æ„é€ ç›®æ ‡ pose
ä½¿ç”¨æ•°å€¼ IK æ±‚è§£ï¼ˆJacobian æ³•ï¼‰
å¦‚æœ IK å¯è¾¾ï¼Œåˆ™å¡« bin = True
æˆ‘å¯ä»¥ä¸ºä½ å†™ä¸€ä¸ªç®€æ´ä½†ç¨³å®šçš„æ•°å€¼ IKï¼ˆç‰›é¡¿æ³• + damped least squaresï¼‰ã€‚
ä»»åŠ¡ 4ï¼šåŠ å…¥ç¢°æ’æ£€æµ‹ï¼ˆå…³é”®ï¼‰
ä½ çš„ XML ä¸­ å·²åŒ…å«æ‰€æœ‰ collision geomsï¼Œæ‰€ä»¥ä¸éœ€è¦ç‚¹äº‘ KD-treeã€‚
åªéœ€åœ¨ FK æˆ– IK åï¼š
mujoco.mj_forward(model, data)
if data.ncon > 0:
    pose is invalid
å³å¯è¿‡æ»¤æ‰ç¢°æ’å§¿æ€ã€‚
ä»»åŠ¡ 5ï¼šè¾“å‡ºä¸å¯è§†åŒ–
å®Œæˆï¼š
capability mapï¼ˆæ¯ä¸ª voxel çš„ reachable ratioï¼‰
3D çƒ­å›¾ï¼ˆmatplotlib æˆ– open3dï¼‰
ä¿å­˜ bitarrayï¼ˆå·²ç»æœ‰ç»“æ„äº†ï¼‰

